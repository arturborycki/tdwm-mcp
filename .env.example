# TDWM MCP Server - OAuth Configuration Example
# Copy this file to .env and modify the values for your environment

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
DATABASE_URI=teradatasql://username:password@hostname/database

# Database connection resilience settings
DB_MAX_RETRIES=3
DB_INITIAL_BACKOFF=1.0
DB_MAX_BACKOFF=30.0

# =============================================================================
# MCP SERVER CONFIGURATION  
# =============================================================================
MCP_TRANSPORT=sse
MCP_HOST=0.0.0.0
MCP_PORT=8000
MCP_PATH=/mcp

# =============================================================================
# OAUTH 2.1 CONFIGURATION
# =============================================================================

# Enable/disable OAuth authentication
OAUTH_ENABLED=false

# Keycloak server configuration (required when OAUTH_ENABLED=true)
KEYCLOAK_URL=https://your-keycloak-server.com
KEYCLOAK_REALM=tdwm-realm
KEYCLOAK_CLIENT_ID=tdwm-mcp

# Client secret (for confidential clients)
KEYCLOAK_CLIENT_SECRET=your-client-secret

# Resource server identification (required when OAUTH_ENABLED=true)
# This should be the URL of your MCP server
OAUTH_RESOURCE_SERVER_URL=https://your-mcp-server.com

# Required scopes (comma-separated, optional)
# If not specified, all requests will be allowed regardless of scopes
OAUTH_REQUIRED_SCOPES=tdwm:read,tdwm:monitor

# Security settings (optional, defaults shown)
OAUTH_VALIDATE_AUDIENCE=true
OAUTH_VALIDATE_SCOPES=true
OAUTH_REQUIRE_HTTPS=true

# =============================================================================
# OAUTH ENDPOINT OVERRIDES (OPTIONAL)
# =============================================================================
# These endpoints are automatically generated from KEYCLOAK_URL and KEYCLOAK_REALM
# Override only if you have custom endpoints

# Token introspection endpoint for opaque token validation
# OAUTH_TOKEN_VALIDATION_ENDPOINT=https://keycloak.example.com/auth/realms/tdwm-realm/protocol/openid-connect/token/introspect

# JWKS endpoint for JWT token validation
# OAUTH_JWKS_ENDPOINT=https://keycloak.example.com/auth/realms/tdwm-realm/protocol/openid-connect/certs

# =============================================================================
# DEVELOPMENT SETTINGS
# =============================================================================
# For development/testing with local Keycloak instance

# Example local development configuration:
# OAUTH_ENABLED=true
# KEYCLOAK_URL=http://localhost:8080
# KEYCLOAK_REALM=tdwm-realm
# KEYCLOAK_CLIENT_ID=tdwm-mcp
# KEYCLOAK_CLIENT_SECRET=tdwm-mcp-secret
# OAUTH_RESOURCE_SERVER_URL=http://localhost:8000
# OAUTH_REQUIRE_HTTPS=false
# OAUTH_REQUIRED_SCOPES=tdwm:read

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_LEVEL=INFO
PYTHONPATH=/app/src

# =============================================================================
# DOCKER CONFIGURATION
# =============================================================================
# When running in Docker, these are typically set in docker-compose.yml
# CONTAINER_NAME=tdwm-mcp-oauth
# RESTART_POLICY=unless-stopped

# =============================================================================
# KEYCLOAK REALM CONFIGURATION REFERENCE
# =============================================================================
# After setting up your Keycloak realm, you'll need these client scopes:
#
# Client Scopes for TDWM:
# - tdwm:read          (Read access to TDWM resources)
# - tdwm:write         (Write access to TDWM resources)  
# - tdwm:admin         (Administrative access)
# - tdwm:query         (Execute SQL queries)
# - tdwm:monitor       (Monitoring operations)
# - tdwm:workload      (Workload management access)
#
# Client Configuration:
# - Client ID: tdwm-mcp
# - Client Protocol: openid-connect
# - Access Type: confidential (if using client secret)
# - Standard Flow: enabled
# - Service Accounts: enabled (for client credentials flow)
# - Valid Redirect URIs: https://your-mcp-server.com/*
#
# TDWM Tool Authorization Matrix:
# =============================================================================
# Session Monitoring Tools:        tdwm:read
# - show_sessions, show_sql_steps_for_session, show_sql_text_for_session
#
# System Monitoring Tools:         tdwm:monitor, tdwm:read  
# - monitor_amp_load, monitor_awt, monitor_config, show_physical_resources
#
# Workload Management Tools:       tdwm:read
# - list_active_WD, list_WD, show_tdwm_summary, list_delayed_request
#
# Administrative Tools:            tdwm:admin
# - abort_sessions_user, abort_delayed_request, release_delay_queue
# - create_filter_rule, add_class_criteria, activate_rulset
#
# Query Analysis Tools:            tdwm:query, tdwm:read
# - show_query_log, show_top_users
#
# Use the provided setup scripts to automatically configure Keycloak:
# docker-compose -f docker-compose.oauth.yml up -d keycloak
# # Then configure realm and client via Keycloak admin console at http://localhost:8080